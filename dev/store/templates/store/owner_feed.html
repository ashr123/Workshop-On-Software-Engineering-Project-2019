{% extends 'base.html' %}
{% block content %}
	<textarea id="chat-log" cols="100" rows="20"></textarea><br/>
	<input id="chat-message-input" type="text" size="100"/><br/>
	<input id="chat-message-submit" type="button" value="Send"/>
	<script>
		{#let ownerId = {{ owner_id_json }};#}

		const
			chatSocket = new WebSocket('ws://' + window.location.host + '/ws/store_owner_feed/' + {{ owner_id }} +'/'),
			messageInputDom = document.querySelector('#chat-message-input'),
			submit = document.querySelector('#chat-message-submit');

		chatSocket.onmessage = e => document.querySelector('#chat-log').value += (JSON.parse(e.data)['message'] + '\n');

		chatSocket.onclose = e => console.error('Chat socket closed unexpectedly');
		messageInputDom.focus();
		messageInputDom.onkeyup = e => {
			if (e.keyCode === 13)
				submit.click();
		};

		submit.onclick = e => {
			chatSocket.send(JSON.stringify({
				'message': messageInputDom.value
			}));
			messageInputDom.value = '';
		};
	</script>
{% endblock %}